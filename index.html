<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="××¢×¨×›×ª ××•×¤×˜×™××™×–×¦×™×” ××ª×§×“××ª ×œ× ×™×”×•×œ 176 ×œ×§×•×—×•×ª ×‘-8 MEGA CLUSTERS ×¢× ×™×¢×™×œ×•×ª 3.02 ×œ×§×•×—×•×ª/×©×¢×”">
    <meta name="keywords" content="×œ×•×’×™×¡×˜×™×§×”, ××¡×œ×•×œ×™×, ××•×¤×˜×™××™×–×¦×™×”, MEGA CLUSTER, GPS, ××¤×•×ª, ×—×œ×•×§×”, ROI">
    <meta name="author" content="AgtRoute - Logistic AI System">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2196F3">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="AgtRoute">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icons/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/icons/apple-touch-icon.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Styles -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/mobile.css">
    <link rel="stylesheet" href="assets/css/animations.css">
    <link rel="stylesheet" href="assets/css/navigationUI.css">
    
    <title>AgtRoute - ××¢×¨×›×ª ××•×¤×˜×™××™×–×¦×™×” ×œ×•×’×™×¡×˜×™×ª | 176 ×œ×§×•×—×•×ª ×‘-8 MEGA CLUSTERS</title>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p>×˜×•×¢×Ÿ ××¢×¨×›×ª ××¡×œ×•×œ×™×...</p>
    </div>

    <!-- Main App Container -->
    <div id="app" class="app-container hidden">
        
        <!-- Enhanced Header with Stats -->
        <header class="app-header">
            <div class="header-content">
                <div class="header-main">
                    <h1 class="app-title">
                        <span class="icon">ğŸš›</span>
                        <span class="title-text">
                            <span class="title-main">AgtRoute</span>
                            <span class="title-sub">Logistic AI System</span>
                        </span>
                    </h1>
                    
                    <!-- Real-time Stats -->
                    <div class="header-stats">
                        <div class="stat-item">
                            <span class="stat-value" id="totalClients">176</span>
                            <span class="stat-label">×œ×§×•×—×•×ª</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="efficiency">3.02</span>
                            <span class="stat-label">×œ×§×•×—/×©×¢×”</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="utilization">97%</span>
                            <span class="stat-label">× ×™×¦×•×œ×ª</span>
                        </div>
                    </div>
                </div>
                
                <div class="header-controls">
                    <button id="refreshBtn" class="btn-icon" title="×¨×¢× ×Ÿ × ×ª×•× ×™×">
                        <span>ğŸ”„</span>
                    </button>
                    <button id="analyticsBtn" class="btn-icon" title="×“×•×—×•×ª ×•× ×™×ª×•×—×™×">
                        <span>ğŸ“Š</span>
                    </button>
                    <button id="settingsBtn" class="btn-icon" title="×”×’×“×¨×•×ª ××ª×§×“××•×ª">
                        <span>âš™ï¸</span>
                    </button>
                    <button id="helpBtn" class="btn-icon" title="×¢×–×¨×” ×•××“×¨×™×š">
                        <span>â“</span>
                    </button>
                </div>
            </div>
            
            <!-- Progress Bar for Daily Routes -->
            <div class="route-progress">
                <div class="progress-bar">
                    <div class="progress-fill" id="dailyProgress" style="width: 0%"></div>
                </div>
                <span class="progress-text" id="progressText">×”×ª×§×“××•×ª ×™×•××™×ª: 0/0</span>
            </div>
        </header>

        <!-- Main Content Area -->
        <main class="main-content">
            
            <!-- Day Filter Tabs -->
            <section class="day-filter-section">
                <div class="day-tabs">
                    <button class="day-tab active" data-day="1">
                        <span class="day-name">×¨××©×•×Ÿ</span>
                        <span class="client-count" id="day1Count">30</span>
                    </button>
                    <button class="day-tab" data-day="2">
                        <span class="day-name">×©× ×™</span>
                        <span class="client-count" id="day2Count">24</span>
                    </button>
                    <button class="day-tab" data-day="3">
                        <span class="day-name">×©×œ×™×©×™</span>
                        <span class="client-count" id="day3Count">20</span>
                    </button>
                    <button class="day-tab" data-day="4">
                        <span class="day-name">×¨×‘×™×¢×™</span>
                        <span class="client-count" id="day4Count">26</span>
                    </button>
                    <button class="day-tab" data-day="5">
                        <span class="day-name">×—××™×©×™</span>
                        <span class="client-count" id="day5Count">76</span>
                    </button>
                </div>
            </section>

            <!-- Enhanced Map Container -->
            <section class="map-section">
                <div class="map-wrapper">
                    <div id="map" class="map-container"></div>
                    
                    <!-- Map Loading Overlay -->
                    <div id="mapLoading" class="map-loading hidden">
                        <div class="loading-spinner"></div>
                        <p>×˜×•×¢×Ÿ ××¤×”...</p>
                    </div>
                    
                    <!-- Map Controls -->
                    <div class="map-controls">
                        <div class="control-group">
                            <button id="centerMapBtn" class="map-btn" title="××¨×›×– ××¤×” ×¢×œ ××—×¡×Ÿ ×©×¨×•× ×”">
                                <span>ğŸ¯</span>
                            </button>
                            <button id="myLocationBtn" class="map-btn" title="×”××™×§×•× ×©×œ×™">
                                <span>ğŸ“</span>
                            </button>
                            <button id="fullscreenBtn" class="map-btn" title="××¡×š ××œ×">
                                <span>â›¶</span>
                            </button>
                        </div>
                        
                        <div class="control-group">
                            <button id="showTrafficBtn" class="map-btn" title="×”×¦×’ ×¢×•××¡×™×">
                                <span>ğŸš—</span>
                            </button>
                            <button id="routePreviewBtn" class="map-btn" title="×ª×¦×•×’×” ××§×“×™××” ×©×œ ××¡×œ×•×œ">
                                <span>ğŸ—ºï¸</span>
                            </button>
                            <button id="clusterToggleBtn" class="map-btn active" title="×”×¦×’/×”×¡×ª×¨ MEGA CLUSTERS">
                                <span>ğŸ”—</span>
                            </button>
                        </div>
                        
                        <div class="control-group">
                            <button id="zoomInBtn" class="map-btn" title="×”×’×“×œ">
                                <span>â•</span>
                            </button>
                            <button id="zoomOutBtn" class="map-btn" title="×”×§×˜×Ÿ">
                                <span>â–</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Map Info Panel -->
                    <div class="map-info-panel">
                        <div class="info-item">
                            <span class="info-label">××¨×—×§ ×›×•×œ×œ:</span>
                            <span class="info-value" id="totalDistance">0 ×§×</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">×–××Ÿ × ×¡×™×¢×”:</span>
                            <span class="info-value" id="totalTime">0 ×©×¢×•×ª</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">×œ×§×•×—×•×ª ×™×•×:</span>
                            <span class="info-value" id="dailyClients">0</span>
                        </div>
                    </div>
                </div>

                <!-- Cluster Legend -->
                <div class="cluster-legend">
                    <h3>MEGA CLUSTERS</h3>
                    <div class="legend-items">
                        <div class="legend-item">
                            <span class="color-dot cluster-1"></span>
                            <span>××•×©×‘ ×©×¨×•× ×” (8)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-dot cluster-2"></span>
                            <span>×©×“×” ××™×œ×Ÿ (11)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-dot cluster-3"></span>
                            <span>××—×™×”×•×“ (9)</span>
                        </div>
                        <div class="legend-item">
                            <span class="color-dot cluster-4"></span>
                            <span>×›×¤×¨ ×™×”×•×©×¢ (8)</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Side Panel for Client Info -->
            <aside id="clientPanel" class="client-panel hidden">
                <div class="panel-header">
                    <h3 id="clientName">×¤×¨×˜×™ ×œ×§×•×—</h3>
                    <button id="closePanelBtn" class="btn-close">Ã—</button>
                </div>
                <div class="panel-content">
                    <div id="clientDetails" class="client-details">
                        <!-- Client information will be populated here -->
                    </div>
                    <div class="panel-actions">
                        <button id="navigateBtn" class="btn-primary">× ×•×•×˜ ×œ×œ×§×•×—</button>
                        <button id="markVisitedBtn" class="btn-secondary">×¡××Ÿ ×›×‘×•×§×¨</button>
                    </div>
                </div>
            </aside>

        </main>

        <!-- Enhanced Bottom Navigation (Responsive) -->
        <nav class="bottom-nav" id="bottomNav">
            <div class="nav-wrapper">
                <!-- Primary Navigation Items -->
                <button class="nav-item active" data-view="map" id="navMap">
                    <span class="nav-icon">ğŸ—ºï¸</span>
                    <span class="nav-label">××¤×”</span>
                    <span class="nav-badge" id="mapBadge">8</span>
                </button>
                
                <button class="nav-item" data-view="routes" id="navRoutes">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span class="nav-label">××¡×œ×•×œ×™×</span>
                    <span class="nav-badge" id="routesBadge">5</span>
                </button>
                
                <button class="nav-item" data-view="clients" id="navClients">
                    <span class="nav-icon">ğŸ‘¥</span>
                    <span class="nav-label">×œ×§×•×—×•×ª</span>
                    <span class="nav-badge" id="clientsBadge">176</span>
                </button>
                
                <button class="nav-item" data-view="progress" id="navProgress">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-label">×”×ª×§×“××•×ª</span>
                    <span class="nav-badge" id="progressBadge">65%</span>
                </button>
                
                <!-- FAB (Floating Action Button) -->
                <button class="nav-fab" id="navFab" title="×”×ª×—×œ ××¡×œ×•×œ ×™×•××™">
                    <span class="fab-icon">ğŸš€</span>
                    <span class="fab-text">×”×ª×—×œ</span>
                </button>
                
                <!-- Secondary Navigation (Expandable) -->
                <button class="nav-item nav-more" data-view="more" id="navMore">
                    <span class="nav-icon">â‹¯</span>
                    <span class="nav-label">×¢×•×“</span>
                </button>
            </div>
            
            <!-- More Menu (Hidden by default) -->
            <div class="nav-more-menu hidden" id="navMoreMenu">
                <div class="more-menu-content">
                    <button class="more-item" data-action="export">
                        <span class="more-icon">ğŸ“¤</span>
                        <span class="more-label">×™×™×¦×•× × ×ª×•× ×™×</span>
                        <span class="more-desc">JSON/CSV/Excel</span>
                    </button>
                    
                    <button class="more-item" data-action="analytics">
                        <span class="more-icon">ğŸ“ˆ</span>
                        <span class="more-label">×× ×œ×™×˜×™×§×”</span>
                        <span class="more-desc">×“×•×—×•×ª ××¤×•×¨×˜×™×</span>
                    </button>
                    
                    <button class="more-item" data-action="settings">
                        <span class="more-icon">âš™ï¸</span>
                        <span class="more-label">×”×’×“×¨×•×ª</span>
                        <span class="more-desc">×”×¢×“×¤×•×ª ××¢×¨×›×ª</span>
                    </button>
                    
                    <button class="more-item" data-action="help">
                        <span class="more-icon">â“</span>
                        <span class="more-label">×¢×–×¨×”</span>
                        <span class="more-desc">××“×¨×™×š ×•×ª××™×›×”</span>
                    </button>
                    
                    <button class="more-item" data-action="sync">
                        <span class="more-icon">ğŸ”„</span>
                        <span class="more-label">×¡× ×›×¨×•×Ÿ</span>
                        <span class="more-desc">×¨×¢× ×Ÿ × ×ª×•× ×™×</span>
                    </button>
                </div>
            </div>
            
            <!-- Navigation Indicator -->
            <div class="nav-indicator" id="navIndicator"></div>
        </nav>

    </div>

    <!-- Offline Indicator -->
    <div id="offlineIndicator" class="offline-indicator hidden">
        <span>ğŸš«</span>
        <span>××¦×‘ ×œ× ××§×•×•×Ÿ</span>
    </div>

    <!-- Scripts -->
    <script src="assets/js/utils.js"></script>
    <script src="assets/js/dataManager.js"></script>
    <script src="assets/js/mapManager.js"></script>
    <script src="assets/js/routeManager.js"></script>
    <script src="assets/js/googleMapsIntegration.js"></script>
    <script src="assets/js/navigationUI.js"></script>
    <script src="assets/js/app.js"></script>
    
    <!-- Google Maps API - Dynamic Loading -->
    <script src="config.js"></script>
    <script>
        // Load Google Maps API dynamically with proper error handling
        function loadGoogleMapsAPI() {
            return new Promise((resolve, reject) => {
                if (window.google && window.google.maps) {
                    resolve();
                    return;
                }
                
                const config = window.GOOGLE_MAPS_CONFIG || {
                    apiKey: 'AIzaSyDemo_Key_Replace_With_Real_Key',
                    libraries: ['geometry', 'places'],
                    language: 'he',
                    region: 'IL'
                };
                
                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${config.apiKey}&libraries=${config.libraries.join(',')}&language=${config.language}&region=${config.region}&callback=initGoogleMaps`;
                script.async = true;
                script.defer = true;
                
                window.initGoogleMaps = () => {
                    delete window.initGoogleMaps;
                    resolve();
                };
                
                script.onerror = () => {
                    console.error('âŒ Failed to load Google Maps API');
                    reject(new Error('Google Maps API failed to load'));
                };
                
                document.head.appendChild(script);
            });
        }
        
        // Initialize app after Google Maps is loaded
        async function initApp() {
            try {
                await loadGoogleMapsAPI();
                console.log('âœ… Google Maps API loaded successfully');
                
                // Initialize AgtRoute app
                if (window.agtRouteApp) {
                    console.log('âœ… AgtRoute app ready');
                } else {
                    console.log('ğŸ”„ Waiting for AgtRoute app initialization...');
                }
            } catch (error) {
                console.error('âŒ App initialization failed:', error);
                document.querySelector('#loadingScreen p').textContent = '×©×’×™××” ×‘×˜×¢×™× ×ª ×”××¤×•×ª - ×‘×“×•×§ ×—×™×‘×•×¨ ×œ××™× ×˜×¨× ×˜';
            }
        }
    </script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator && window.location.protocol === 'https:' || window.location.hostname === 'localhost') {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('./sw.js', {
                        scope: './',
                        updateViaCache: 'none'
                    });
                    console.log('âœ… Service Worker registered:', registration.scope);
                    
                    // Handle updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                console.log('ğŸ”„ New content available, will update on next visit');
                            }
                        });
                    });
                    
                } catch (error) {
                    console.warn('âš ï¸ Service Worker registration failed:', error);
                    // App should still work without service worker
                }
            });
        } else {
            console.log('â„¹ï¸ Service Worker not supported or not on HTTPS');
        }
    </script>

</body>
</html>
